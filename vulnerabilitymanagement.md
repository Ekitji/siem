# Windows OS Version and build status
## Windows 10 vs Windows 11 Version Detection And Build Version

Both **Windows 10** and **Windows 11** use `MajorVersion = 10` in system APIs and event logs because Microsoft kept it for backward compatibility.

To differentiate them, use the **build number**:

| OS          | MajorVersion | Build Range          | Notes                        |
|-------------|--------------|----------------------|-------------------------------|
| Windows 10   | 10           | 10240 → 19045        | Version 1507 → 22H2            |
| Windows 11   | 10           | 22000+               | 22000 = Win11 21H2, 22621 = 22H2 |

**Key Points:**
- Windows 11 starts at **build 22000**.
- `MajorVersion = 10` **below 22000** → Windows 10.
- `MajorVersion = 10` **22000+** → Windows 11.

**Example:**  
- `MajorVersion: 10` → Used for both Win10 & Win11  
- `BuildVersion: 22621` → Windows 11 (22H2) because it's **above 22000**

### Query
```
event.provider: Microsoft-Windows-Kernel-General AND event.code: 12
```

#### Windows Event Log Version Fields

| Field                          | What It Means                                                                                   | Example  |
|--------------------------------|--------------------------------------------------------------------------------------------------|----------|
| `winlog.event_data.BuildVersion`   | The build number of Windows. Main indicator for Windows 10 vs 11 (e.g., 22621 = Win11 22H2).      | 22621    |
| `winlog.event_data.MajorVersion`   | The major OS version. Both Windows 10 and 11 use **10** for backward compatibility.              | 10       |
| `winlog.event_data.MinorVersion`   | The minor OS version. For most modern Windows versions, this stays at **0**.                     | 0        |
| `winlog.event_data.QfeVersion`     | The Quick Fix Engineering (QFE) number, essentially the **patch level** or **cumulative update**.| 5909     |
| `winlog.event_data.ServiceVersion` | Usually **0** in modern builds; older versions used this for service pack levels (e.g., SP1).     | 0        |

#### How to Use Them
- **BuildVersion** → Main indicator of OS version (Win10 vs Win11).  
- **QfeVersion** → Tracks patch levels (higher = more recent updates).  
- **Major/MinorVersion** → Mostly for backward compatibility with older apps/scripts.




## Windows Defender Version/Signature detection

### Query
```
event.provider: "Microsoft-Windows-Windows Defender"
```
- winlog.event_data.Product Version
- winlog.event_data.Previous Engine Version
- winlog.event_data.Previous security intelligence Version
- winlog.event_data.Engine Version
- winlog.event_data.Security intelligence Version
- winlog.event_data.Loading engine version
- winlog.event_data.Loading security intelligence version


#### Windows Defender: Version / Security Intelligence Fields

| Field Name                             | Meaning                                                                 |
|-----------------------------------------|-------------------------------------------------------------------------|
| `Product Version`                       | Defender product/platform version                                       |
| `Previous Engine Version`               | Engine version before the update                                         |
| `Previous Security Intelligence Version` | Definitions version before the update                                    |
| `Engine Version`                        | Current antimalware engine version                                       |
| `Security Intelligence Version`         | Current signature/definitions version                                    |
| `Loading Engine Version`                | Engine version being loaded during update                               |
| `Loading Security Intelligence Version`  | Definitions version being loaded during update                           |

## Microsoft Defender Exclusion enumeration
### Based upon Group Policies (GPO)
#### Shows Processes, File extensions and File paths - Look for ones in User-Writable paths or other over-permissive exclusions or wildcards.

```
(event.provider: "Microsoft-Windows-Windows Defender" AND event.code: 5007 AND winlog.event_data.New\ Value: HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\ Defender\\Exclusions\\Processes\\* OR  HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\ Defender\\Exclusions\\Paths\\*
OR  HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\ Defender\\Exclusions\\Extensions\\*)
```
### Based upon Local setting (local admin)
#### Shows Processes, File extensions and File paths - Look for ones in User-Writable paths or other over-permissive exclusions or wildcards.
```
(event.provider: "Microsoft-Windows-Windows Defender" AND event.code: 5007 AND winlog.event_data.New\ Value: HKLM\\SOFTWARE\\Microsoft\\Windows\ Defender\\Exclusions\\Processes\\* OR HKLM\\SOFTWARE\\Microsoft\\Windows\ Defender\\Exclusions\\Paths\\* OR HKLM\\SOFTWARE\\Microsoft\\Windows\ Defender\\Exclusions\\Extensions\\*)
```

## Microsoft Attack Surface Reduction rules (ASR)
### Based upon Group Policies (GPO)
#### Query for finding misconfigured ASR - Look for User writable paths in the exclusions path or other over-permissive exclusions or wildcards.
```
(event.provider: "Microsoft-Windows-Windows Defender" AND event.code: 5007 AND winlog.event_data.New\ Value: HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\ Defender\\Policy\ Manager\\Windows\ Defender\ Exploit\ Guard\\ASR\\ASROnlyExclusions\\*)
```

### Based upon Local setting (Local admin)
#### Query for finding misconfigured ASR - Look for User writable paths in the exclusions path or other over-permissive exclusions or wildcards.
```
event.provider: "Microsoft-Windows-Windows Defender" AND event.code: 5007 AND winlog.event_data.New\ Value: HKLM\\SOFTWARE\\Microsoft\\Windows\ Defender\\Windows\ Defender\ Exploit\ Guard\\ASR\\ASROnlyExclusions\\*
```


#### ref. https://primusinterp.com/posts/WindowsASR/


## Microsoft Windows Applocker Enumeration
### Look for winlog.user_data.RuleName if there is any one hinting to over permissive exclusions and/or confirm the ACL with winlog.user_data.RuleSddl
#### Query will give you opportunity to show whats is allowed to run etc and look into the SDDL for the rule.
```
(event.provider: "Microsoft-Windows-AppLocker" AND winlog.user_data.RuleSddl: *)
```
